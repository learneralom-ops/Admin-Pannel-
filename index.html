<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Earne - Admin Panel</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;500;700&display=swap');
        :root { --bg-color: #1a1a2e; --sidebar-color: #16213e; --card-color: #1f2847; --primary-color: #0f3460; --accent-color: #e94560; --text-color: #e0e0e0; --text-secondary: #a0a0c0; --border-color: #30395e; --success-color: #28a745; --error-color: #dc3545; }
        
        body { font-family: 'Roboto', 'Noto Sans Bengali', sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; min-height: 100vh; }
        
        .sidebar { background-color: var(--sidebar-color); width: 250px; padding: 20px; display: flex; flex-direction: column; position: fixed; top: 0; left: 0; height: 100%; z-index: 1000; transform: translateX(-100%); transition: transform 0.3s ease-in-out; box-sizing: border-box; }
        .sidebar.open { transform: translateX(0); }
        .main-content { flex-grow: 1; padding: 30px; transition: margin-left 0.3s ease-in-out; }
        @media (min-width: 768px) { body.sidebar-open .main-content { margin-left: 250px; } }
        #menu-toggle { position: fixed; top: 15px; left: 15px; z-index: 1001; background: var(--primary-color); border: none; color: white; width: 40px; height: 40px; border-radius: 8px; cursor: pointer; display: flex; flex-direction: column; justify-content: space-around; padding: 8px; box-sizing: border-box; }
        #menu-toggle .bar { width: 100%; height: 3px; background-color: white; border-radius: 2px; }
        #sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; display: none; }
        @media (max-width: 767px) { body.sidebar-open #sidebar-overlay { display: block; } }
        .sidebar h1 { color: var(--accent-color); text-align: center; margin-bottom: 30px; }
        .sidebar nav a { display: block; color: var(--text-color); padding: 15px; text-decoration: none; border-radius: 8px; margin-bottom: 10px; transition: background-color 0.2s; }
        .sidebar nav a.active, .sidebar nav a:hover { background-color: var(--primary-color); }
        .page { display: none; }
        .page.active { display: block; }
        h2 { border-bottom: 2px solid var(--primary-color); padding-bottom: 10px; margin-bottom: 20px; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .card { background-color: var(--card-color); padding: 25px; border-radius: 12px; border-left: 5px solid var(--accent-color); }
        .card h3 { margin: 0 0 10px; color: var(--text-secondary); }
        .card p { font-size: 2rem; font-weight: 700; margin: 0; color: #fff; }
        .table-container { background-color: var(--card-color); padding: 20px; border-radius: 12px; margin-top: 30px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--border-color); white-space: nowrap; }
        th { background-color: var(--primary-color); }
        tr:hover { background-color: rgba(255, 255, 255, 0.05); }
        .btn { padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; }
        .btn-success { background-color: var(--success-color); color: white; }
        .btn-danger { background-color: var(--error-color); color: white; }
        .btn-primary { background-color: var(--accent-color); color: white; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-secondary); }
        .form-control { width: 100%; padding: 12px; background-color: var(--bg-color); border: 1px solid var(--border-color); color: var(--text-color); border-radius: 6px; box-sizing: border-box; }
        .form-control:focus { outline: none; border-color: var(--accent-color); }
        textarea.form-control { min-height: 100px; resize: vertical; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); display: none; justify-content: center; align-items: center; z-index: 1050; padding: 20px; box-sizing: border-box; }
        .modal-content { background: var(--card-color); padding: 30px; border-radius: 12px; width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-color); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        #login-box { background: var(--card-color); padding: 40px; border-radius: 12px; text-align: center; width: 90%; max-width: 350px; }
        #login-box h2 { margin-top: 0; }
        .settings-section { background-color: var(--card-color); padding: 20px; border-radius: 8px; margin-bottom: 25px; }
        .settings-section h3 { margin-top: 0; color: var(--accent-color); border-bottom: 1px solid var(--border-color); padding-bottom: 10px; }
        .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        
        /* [ADDED] New Styles for Admin Info and Logout */
        .admin-info {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            text-align: center;
        }
        #admin-email-display {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin: 0 0 15px 0;
            word-break: break-all;
        }
        #logout-btn {
            background-color: var(--error-color);
            color: white;
            width: 100%;
        }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div id="login-box">
            <h2>Admin Login</h2>
            <div class="form-group"><input type="email" id="admin-email-input" class="form-control" placeholder="Enter Admin Email"></div>
            <div class="form-group"><input type="password" id="admin-password" class="form-control" placeholder="Enter Password"></div>
            <button id="login-btn" class="btn btn-primary">Login</button>
        </div>
    </div>

    <aside class="sidebar">
        <div>
            <h1>Admin Panel</h1>
            <nav>
                <a href="#" class="nav-item active" data-page="dashboard">Dashboard</a>
                <a href="#" class="nav-item" data-page="users">Users</a>
                <a href="#" class="nav-item" data-page="withdrawals">Withdrawals</a>
                <a href="#" class="nav-item" data-page="settings">Settings</a>
                <a href="#" class="nav-item" data-page="broadcast">Broadcast</a>
            </nav>
        </div>
        <div class="admin-info">
            <p id="admin-email-display">Not logged in</p>
            <button id="logout-btn" class="btn">Logout</button>
        </div>
    </aside>

    <div id="sidebar-overlay"></div>

    <main class="main-content" style="display: none;">
        <button id="menu-toggle" style="display: none;"><div class="bar"></div><div class="bar"></div><div class="bar"></div></button>

        <div id="page-dashboard" class="page active"><h2>Dashboard</h2><div class="dashboard-grid"><div class="card"><h3>Total Users</h3><p id="total-users">0</p></div><div class="card"><h3>Pending Withdrawals</h3><p id="pending-withdrawals">0</p></div><div class="card"><h3>Total Withdrawn (Taka)</h3><p id="total-withdrawn">0</p></div><div class="card"><h3>Total Balance (All Users)</h3><p id="total-balance">0</p></div></div></div>
        
        <div id="page-users" class="page">
            <h2>Users Management</h2>
            <div class="form-group"><input type="text" id="user-search" class="form-control" placeholder="Search by Name, Email, or Phone..."></div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Balance (TK)</th>
                            <th>Referrals</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="users-table-body"></tbody>
                </table>
            </div>
        </div>
        
        <div id="page-withdrawals" class="page"><h2>Withdrawal Requests</h2><div class="table-container"><h3>Pending Requests</h3><table><thead><tr><th>User Name</th><th>Amount</th><th>Method</th><th>Number</th><th>Actions</th></tr></thead><tbody id="pending-withdrawals-table"></tbody></table></div><div class="table-container" style="margin-top:30px;"><h3>Completed/Rejected History</h3><table><thead><tr><th>User Name</th><th>Amount</th><th>Method</th><th>Number</th><th>Status</th></tr></thead><tbody id="completed-withdrawals-table"></tbody></table></div></div>
        
        <div id="page-settings" class="page">
             <h2>App Settings</h2>
            <form id="settings-form">
                <div class="settings-section"><h3>General Settings</h3><div class="form-group"><label for="minWithdrawAmount">Minimum Withdraw Amount</label><input type="number" id="minWithdrawAmount" class="form-control"></div><div class="form-group"><label for="minWithdrawReferrals">Minimum Referrals for Withdraw</label><input type="number" id="minWithdrawReferrals" class="form-control"></div></div>
                <div class="settings-section"><h3>Reward & Task Settings</h3><div class="form-group"><label for="adReward">Reward per Task (Taka)</label><input type="number" id="adReward" class="form-control" step="0.01"></div><div class="form-group"><label for="referralReward">Reward per Referral (Taka)</label><input type="number" id="referralReward" class="form-control" step="0.01"></div><div class="form-group"><label for="homeTaskCountdown">Home Page Task Countdown (Seconds)</label><input type="number" id="homeTaskCountdown" class="form-control" placeholder="e.g., 30"></div></div>
                <div class="settings-section"><h3>Content & UI Settings</h3><div class="form-group"><label for="authImageUrl">Sign Up Page Image URL</label><input type="url" id="authImageUrl" class="form-control" placeholder="https://i.ibb.co/hR5z06w/auth-logo.png"></div><div class="form-group"><label for="marqueeText">Scrolling Offer Text (Marquee)</label><input type="text" id="marqueeText" class="form-control"></div><div class="form-group"><label for="welcomeMessageTitle">Welcome Popup Title</label><input type="text" id="welcomeMessageTitle" class="form-control"></div><div class="form-group"><label for="welcomeMessageBody">Welcome Popup Body (HTML Allowed)</label><textarea id="welcomeMessageBody" class="form-control" rows="4"></textarea></div><div class="form-group"><label for="noticeContent">Notice Popup Content (HTML Allowed)</label><textarea id="noticeContent" class="form-control" rows="4"></textarea></div></div>
                <div class="settings-section"><h3>Link Settings</h3><div class="form-group"><label for="tutorialLink">Tutorial Video Link</label><input type="text" id="tutorialLink" class="form-control"></div><div class="form-group"><label for="adminChatLink">Admin Chat Link</label><input type="text" id="adminChatLink" class="form-control"></div><div class="form-group"><label for="adminCallLink">Admin Call Link (e.g., tel:+8801...)</label><input type="text" id="adminCallLink" class="form-control"></div><div class="form-group"><label for="telegramChannelLink">Telegram Channel Link (for Task)</label><input type="text" id="telegramChannelLink" class="form-control"></div><div class="form-group"><label for="youtubeChannelLink">YouTube Channel Link (for Task)</label><input type="text" id="youtubeChannelLink" class="form-control"></div></div>
                <div class="settings-section"><h3>Advanced: Ad Network Codes</h3><div class="form-group"><label for="monetagZoneId">Monetag Zone ID</label><input type="text" id="monetagZoneId" class="form-control" placeholder="e.g., 8954258"></div><div class="form-group"><label for="gigaPubId">Giga Pub Script ID</label><input type="text" id="gigaPubId" class="form-control" placeholder="e.g., 3247"></div></div>
                <button type="submit" class="btn btn-primary" style="width:100%; padding: 15px; font-size: 1.1rem;">Save All Settings</button>
            </form>
        </div>
        
        <div id="page-broadcast" class="page"><h2>Send Broadcast Message</h2><form id="broadcast-form"><div class="form-group"><label for="broadcast-message">Message</label><textarea id="broadcast-message" class="form-control" rows="4" required></textarea></div><div class="form-group"><label for="broadcast-image-url">Image URL (Optional)</label><input type="url" id="broadcast-image-url" class="form-control"></div><button type="submit" class="btn btn-primary">Send to All App Users</button></form></div>
    </main>

    <!-- Edit User Modal -->
    <div id="edit-user-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h3>Edit User Details</h3><span style="cursor:pointer; font-size: 24px;" id="close-modal">&times;</span></div>
            <form id="edit-user-form">
                <input type="hidden" id="edit-user-id">
                <div class="grid-2">
                    <div class="form-group"><label for="edit-user-name">Full Name</label><input type="text" id="edit-user-name" class="form-control"></div>
                    <div class="form-group"><label for="edit-user-email">Email Address</label><input type="email" id="edit-user-email" class="form-control" readonly></div>
                </div>
                <div class="grid-2">
                    <div class="form-group"><label for="edit-user-mobile">Phone Number</label><input type="tel" id="edit-user-mobile" class="form-control"></div>
                    <div class="form-group"><label for="edit-user-balance">Balance</label><input type="number" id="edit-user-balance" class="form-control" step="0.01"></div>
                </div>
                <div class="form-group"><label for="edit-user-referrals">Referrals</label><input type="number" id="edit-user-referrals" class="form-control"></div>
                <p style="color:var(--text-secondary); font-size: 0.9em; border: 1px dashed var(--border-color); padding: 10px; border-radius: 6px;">
                    <strong>Security Note:</strong> User passwords cannot be viewed or changed directly. Users can reset their own password via the app.
                </p>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </form>
            <hr style="border-color: var(--border-color); margin: 25px 0;">
            <button id="delete-user-btn" class="btn btn-danger" style="width: 100%;">Delete This User Permanently</button>
        </div>
    </div>
    
    <script>
        // UI navigation script
        document.addEventListener('DOMContentLoaded', () => {
            const menuToggle = document.getElementById('menu-toggle');
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            const body = document.body;
            const toggleSidebar = () => { sidebar.classList.toggle('open'); body.classList.toggle('sidebar-open'); };
            menuToggle.addEventListener('click', toggleSidebar);
            overlay.addEventListener('click', toggleSidebar);
            document.querySelectorAll('.sidebar .nav-item').forEach(link => {
                link.addEventListener('click', (e) => { 
                    e.preventDefault();
                    if (window.innerWidth < 768 && sidebar.classList.contains('open')) { toggleSidebar(); }
                    document.querySelector('.nav-item.active').classList.remove('active');
                    document.querySelector('.page.active').classList.remove('active');
                    link.classList.add('active');
                    const pageId = `page-${link.dataset.page}`;
                    document.getElementById(pageId).classList.add('active');
                    loadPageData(link.dataset.page);
                });
            });
        });
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getDatabase, ref, onValue, get, set, update, remove } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA2HUBFhHEWg4MwkJB4BVdJxUun0Gy07Ts",
            authDomain: "daily-earne-aea89.firebaseapp.com",
            databaseURL: "https://daily-earne-aea89-default-rtdb.firebaseio.com",
            projectId: "daily-earne-aea89",
            storageBucket: "daily-earne-aea89.appspot.com",
            messagingSenderId: "444567470638",
            appId: "1:444567470638:web:0fa323d9f5ef6aba1155bf"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        // --- Auth State Handling ---
        function showAdminPanel(user) {
            document.getElementById('login-overlay').style.display = 'none';
            document.querySelector('.main-content').style.display = 'block';
            document.getElementById('menu-toggle').style.display = 'flex';
            document.getElementById('admin-email-display').innerText = user.email;
            if (window.innerWidth >= 768) {
                document.querySelector('.sidebar').classList.add('open');
                document.body.classList.add('sidebar-open');
            }
            loadPageData('dashboard');
        }

        function showLoginScreen() {
            document.getElementById('login-overlay').style.display = 'flex';
            document.querySelector('.main-content').style.display = 'none';
            document.getElementById('menu-toggle').style.display = 'none';
            document.body.classList.remove('sidebar-open');
            document.querySelector('.sidebar').classList.remove('open');
        }

        onAuthStateChanged(auth, (user) => {
            if (user) { showAdminPanel(user); } 
            else { showLoginScreen(); }
        });

        document.getElementById('login-btn').addEventListener('click', () => {
            const email = document.getElementById('admin-email-input').value;
            const password = document.getElementById('admin-password').value;
            signInWithEmailAndPassword(auth, email, password)
                .catch((error) => alert('Login Failed: ' + error.message));
        });

        document.getElementById('logout-btn').addEventListener('click', () => {
            signOut(auth).catch((error) => alert('Logout failed: ' + error.message));
        });

        // --- Page Data Loading ---
        function loadPageData(page) {
            if (page === 'dashboard') loadDashboardData();
            if (page === 'users') loadUsers();
            if (page === 'withdrawals') loadWithdrawals();
            if (page === 'settings') loadSettings();
        }

        function loadDashboardData() {
            onValue(ref(db, 'users'), s => { const d = s.val(); document.getElementById('total-users').innerText = d ? Object.keys(d).length : 0; document.getElementById('total-balance').innerText = d ? Object.values(d).reduce((sum, u) => sum + (u.balance || 0), 0).toFixed(2) : '0.00'; });
            onValue(ref(db, 'withdrawals/pending'), s => { document.getElementById('pending-withdrawals').innerText = s.exists() ? Object.keys(s.val()).length : 0; });
            onValue(ref(db, 'withdrawals/completed'), s => { const d = s.val(); const t = d ? Object.values(d).filter(w => w.status === 'approved').reduce((sum, w) => sum + (w.amount || 0), 0) : 0; document.getElementById('total-withdrawn').innerText = t.toFixed(2); });
        }
        
        // --- Users Management ---
        let allUsersData = {};
        function loadUsers() {
            const usersRef = ref(db, 'users');
            onValue(usersRef, (snapshot) => {
                allUsersData = snapshot.exists() ? snapshot.val() : {};
                renderUsersTable(allUsersData);
            }, (error) => {
                // [ADDED] Error handling for database reads
                console.error("Firebase Read Error on /users:", error);
                alert("Could not load user data. Check console for errors and verify your database security rules.");
            });
        }
        function renderUsersTable(users) {
            const tBody = document.getElementById('users-table-body');
            tBody.innerHTML = '';
            if (!users || Object.keys(users).length === 0) {
                tBody.innerHTML = '<tr><td colspan="6" style="text-align:center;">No users found in the database.</td></tr>';
                return;
            }
            const usersArray = Object.keys(users).map(uid => ({ uid, ...users[uid] }));
            usersArray.sort((a, b) => new Date(b.joinDate || 0) - new Date(a.joinDate || 0));

            for (const user of usersArray) {
                const u = user;
                const uid = user.uid;
                const searchableString = `${u.name||''} ${u.email||''} ${u.mobile||''}`.toLowerCase();
                
                tBody.innerHTML += `
                    <tr data-uid="${uid}" data-search="${searchableString}">
                        <td>${u.name || 'N/A'}</td>
                        <td>${u.email || 'N/A'}</td>
                        <td>${u.mobile || 'N/A'}</td>
                        <td>${(u.balance || 0).toFixed(2)}</td>
                        <td>${u.referrals || 0}</td>
                        <td><button class="btn btn-primary edit-user-btn" data-id="${uid}">Edit</button></td>
                    </tr>`;
            }
        }
        document.getElementById('user-search').addEventListener('keyup', e => {
            const term = e.target.value.toLowerCase();
            document.querySelectorAll('#users-table-body tr').forEach(r => {
                r.style.display = r.dataset.search.includes(term) ? '' : 'none';
            });
        });

        // --- Edit/Delete User Modal Logic ---
        const modal = document.getElementById('edit-user-modal');
        document.getElementById('users-table-body').addEventListener('click', e => {
            if (e.target.classList.contains('edit-user-btn')) {
                const uid = e.target.dataset.id;
                const u = allUsersData[uid];
                if(u){
                    document.getElementById('edit-user-id').value = uid;
                    document.getElementById('edit-user-name').value = u.name || '';
                    document.getElementById('edit-user-email').value = u.email || '';
                    document.getElementById('edit-user-mobile').value = u.mobile || '';
                    document.getElementById('edit-user-balance').value = u.balance || 0;
                    document.getElementById('edit-user-referrals').value = u.referrals || 0;
                    modal.style.display = 'flex';
                }
            }
        });
        document.getElementById('close-modal').onclick = () => modal.style.display = 'none';
        
        document.getElementById('edit-user-form').addEventListener('submit', e => {
            e.preventDefault();
            const uid = document.getElementById('edit-user-id').value;
            const updates = {
                name: document.getElementById('edit-user-name').value.trim(),
                mobile: document.getElementById('edit-user-mobile').value.trim(),
                balance: parseFloat(document.getElementById('edit-user-balance').value),
                referrals: parseInt(document.getElementById('edit-user-referrals').value)
            };
            update(ref(db, `users/${uid}`), updates).then(() => {
                alert('User updated successfully!');
                modal.style.display = 'none';
            }).catch(err => alert('Error updating user: ' + err.message));
        });

        document.getElementById('delete-user-btn').addEventListener('click', () => {
            const uid = document.getElementById('edit-user-id').value;
            const userName = document.getElementById('edit-user-name').value;
            if (confirm(`Are you sure you want to permanently delete user "${userName}"? This will remove their data from the database. This action cannot be undone.`)) {
                remove(ref(db, `users/${uid}`)).then(() => {
                    alert('User data deleted successfully from the database.');
                    modal.style.display = 'none';
                }).catch(err => alert('Error deleting user: ' + err.message));
            }
        });
        
        // --- Withdrawals Management ---
        function loadWithdrawals() { onValue(ref(db, 'withdrawals/pending'), s => { const t = document.getElementById('pending-withdrawals-table'); t.innerHTML = ''; if (s.exists()) { for (const id in s.val()) { const r = s.val()[id]; t.innerHTML += `<tr><td>${r.userName||'N/A'}</td><td>${r.amount}</td><td>${r.method}</td><td>${r.accountNumber}</td><td><button class="btn btn-success" onclick="handleWithdrawal('${id}', 'approved')">Approve</button><button class="btn btn-danger" onclick="handleWithdrawal('${id}', 'rejected')">Reject</button></td></tr>`; } } else { t.innerHTML = '<tr><td colspan="5">No pending requests.</td></tr>'; } }); onValue(ref(db, 'withdrawals/completed'), s => { const t = document.getElementById('completed-withdrawals-table'); t.innerHTML = ''; if(s.exists()){ const history = Object.values(s.val()).sort((a,b) => (b.timestamp || 0) - (a.timestamp || 0)); history.forEach(r => { t.innerHTML += `<tr><td>${r.userName||'N/A'}</td><td>${r.amount}</td><td>${r.method}</td><td>${r.accountNumber}</td><td style="color:${r.status==='approved'?'var(--success-color)':'var(--error-color)'}; text-transform: capitalize;">${r.status}</td></tr>`; }); } else { t.innerHTML = '<tr><td colspan="5">No history found.</td></tr>'; } }); }
        window.handleWithdrawal = async (id, status) => { const reqRef = ref(db, `withdrawals/pending/${id}`); const s = await get(reqRef); if (!s.exists()) { alert('Request already processed.'); return; } const d = s.val(); d.status = status; d.timestamp = Date.now(); if (status === 'rejected') { const userBalRef = ref(db, `users/${d.userId}/balance`); const userBal = (await get(userBalRef)).val() || 0; await set(userBalRef, userBal + d.amount); } await set(ref(db, `withdrawals/completed/${id}`), d); await remove(reqRef); alert(`Request has been ${status}.`); }

        // --- Settings Management ---
        function loadSettings() { get(ref(db, 'settings')).then(snapshot => { if(snapshot.exists()) { const data = snapshot.val(); for (const key in data) { const element = document.getElementById(key); if (element) { element.value = data[key]; } } } }); }
        document.getElementById('settings-form').addEventListener('submit', e => { e.preventDefault(); const settings = { minWithdrawAmount: parseInt(document.getElementById('minWithdrawAmount').value) || 0, minWithdrawReferrals: parseInt(document.getElementById('minWithdrawReferrals').value) || 0, adReward: parseFloat(document.getElementById('adReward').value) || 0, referralReward: parseFloat(document.getElementById('referralReward').value) || 0, homeTaskCountdown: parseInt(document.getElementById('homeTaskCountdown').value) || 30, authImageUrl: document.getElementById('authImageUrl').value.trim(), marqueeText: document.getElementById('marqueeText').value.trim(), welcomeMessageTitle: document.getElementById('welcomeMessageTitle').value, welcomeMessageBody: document.getElementById('welcomeMessageBody').value, noticeContent: document.getElementById('noticeContent').value, tutorialLink: document.getElementById('tutorialLink').value.trim(), adminChatLink: document.getElementById('adminChatLink').value.trim(), adminCallLink: document.getElementById('adminCallLink').value.trim(), telegramChannelLink: document.getElementById('telegramChannelLink').value.trim(), youtubeChannelLink: document.getElementById('youtubeChannelLink').value.trim(), monetagZoneId: document.getElementById('monetagZoneId').value.trim(), gigaPubId: document.getElementById('gigaPubId').value.trim() }; set(ref(db, 'settings'), settings).then(() => { alert('Settings saved successfully!'); }).catch(err => alert('Error saving settings: ' + err.message)); });

        // --- Broadcast Management ---
        document.getElementById('broadcast-form').addEventListener('submit', e => { e.preventDefault(); const message = { text: document.getElementById('broadcast-message').value, imageUrl: document.getElementById('broadcast-image-url').value.trim() || null, timestamp: Date.now() }; if (!message.text) { alert('Message cannot be empty.'); return; } set(ref(db, 'broadcast/latestMessage'), message).then(() => { alert('Broadcast message sent to all users!'); document.getElementById('broadcast-form').reset(); }).catch(err => alert('Error: ' + err.message)); });
    </script>
</body>
</html>
