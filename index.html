<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Earne - Admin Panel</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;500;700&display=swap');
        :root { --bg-color: #1a1a2e; --sidebar-color: #16213e; --card-color: #1f2847; --primary-color: #0f3460; --accent-color: #e94560; --text-color: #e0e0e0; --text-secondary: #a0a0c0; --border-color: #30395e; --success-color: #28a745; --error-color: #dc3545; }
        
        body { font-family: 'Roboto', 'Noto Sans Bengali', sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; min-height: 100vh; }
        
        .sidebar { background-color: var(--sidebar-color); width: 250px; padding: 20px; display: flex; flex-direction: column; position: fixed; top: 0; left: 0; height: 100%; z-index: 1000; transform: translateX(-100%); transition: transform 0.3s ease-in-out; box-sizing: border-box; }
        .sidebar.open { transform: translateX(0); }
        .main-content { flex-grow: 1; padding: 30px; transition: margin-left 0.3s ease-in-out; }
        @media (min-width: 768px) { body.sidebar-open .main-content { margin-left: 250px; } }
        #menu-toggle { position: fixed; top: 15px; left: 15px; z-index: 1001; background: var(--primary-color); border: none; color: white; width: 40px; height: 40px; border-radius: 8px; cursor: pointer; display: flex; flex-direction: column; justify-content: space-around; padding: 8px; box-sizing: border-box; }
        #menu-toggle .bar { width: 100%; height: 3px; background-color: white; border-radius: 2px; }
        #sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; display: none; }
        @media (max-width: 767px) { body.sidebar-open #sidebar-overlay { display: block; } }
        .sidebar h1 { color: var(--accent-color); text-align: center; margin-bottom: 30px; }
        .sidebar nav a { display: block; color: var(--text-color); padding: 15px; text-decoration: none; border-radius: 8px; margin-bottom: 10px; transition: background-color 0.2s; }
        .sidebar nav a.active, .sidebar nav a:hover { background-color: var(--primary-color); }
        .page { display: none; }
        .page.active { display: block; }
        h2 { border-bottom: 2px solid var(--primary-color); padding-bottom: 10px; margin-bottom: 20px; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .card { background-color: var(--card-color); padding: 25px; border-radius: 12px; border-left: 5px solid var(--accent-color); }
        .card h3 { margin: 0 0 10px; color: var(--text-secondary); }
        .card p { font-size: 2rem; font-weight: 700; margin: 0; color: #fff; }
        .table-container { background-color: var(--card-color); padding: 20px; border-radius: 12px; margin-top: 30px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--border-color); white-space: nowrap; }
        th { background-color: var(--primary-color); }
        tr:hover { background-color: rgba(255, 255, 255, 0.05); }
        .btn { padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; transition: background-color 0.2s; }
        .btn:hover { opacity: 0.9; } .btn:disabled { background-color: #555; cursor: not-allowed; }
        .btn-success { background-color: var(--success-color); color: white; }
        .btn-danger { background-color: var(--error-color); color: white; }
        .btn-primary { background-color: var(--accent-color); color: white; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-secondary); }
        .form-control { width: 100%; padding: 12px; background-color: var(--bg-color); border: 1px solid var(--border-color); color: var(--text-color); border-radius: 6px; box-sizing: border-box; }
        .form-control:focus { outline: none; border-color: var(--accent-color); }
        textarea.form-control { min-height: 100px; resize: vertical; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); display: none; justify-content: center; align-items: center; z-index: 1050; padding: 20px; box-sizing: border-box; }
        .modal-content { background: var(--card-color); padding: 30px; border-radius: 12px; width: 90%; max-width: 700px; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-color); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        #login-box { background: var(--card-color); padding: 40px; border-radius: 12px; text-align: center; width: 90%; max-width: 350px; }
        #login-box h2 { margin-top: 0; }
        .settings-section { background-color: var(--card-color); padding: 20px; border-radius: 8px; margin-bottom: 25px; }
        .settings-section h3 { margin-top: 0; color: var(--accent-color); border-bottom: 1px solid var(--border-color); padding-bottom: 10px; }
        .admin-info { margin-top: auto; padding-top: 20px; border-top: 1px solid var(--border-color); text-align: center; }
        #admin-email-display { font-size: 0.9em; color: var(--text-secondary); margin: 0 0 15px 0; word-break: break-all; }
        #logout-btn { background-color: var(--error-color); color: white; width: 100%; }
        .adjustment-group { display: flex; align-items: center; gap: 10px; margin-top: 8px; }
        .user-meta-info { background-color: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 0.9em; color: var(--text-secondary); }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div id="login-box">
            <h2>Admin Login</h2>
            <form id="login-form">
                <div class="form-group"><input type="email" id="admin-email-input" class="form-control" placeholder="Enter Admin Email" required></div>
                <div class="form-group"><input type="password" id="admin-password" class="form-control" placeholder="Enter Password" required></div>
                <button type="submit" id="login-btn" class="btn btn-primary">Login</button>
            </form>
        </div>
    </div>

    <aside class="sidebar">
        <div>
            <h1>Admin Panel</h1>
            <nav>
                <a href="#" class="nav-item active" data-page="dashboard">Dashboard</a>
                <a href="#" class="nav-item" data-page="users">Users</a>
                <a href="#" class="nav-item" data-page="withdrawals">Withdrawals</a>
                <a href="#" class="nav-item" data-page="settings">Settings</a>
                <a href="#" class="nav-item" data-page="broadcast">Broadcast</a>
            </nav>
        </div>
        <div class="admin-info">
            <p id="admin-email-display">Not logged in</p>
            <button id="logout-btn" class="btn">Logout</button>
        </div>
    </aside>

    <div id="sidebar-overlay"></div>

    <main class="main-content" style="display: none;">
        <button id="menu-toggle" style="display: none;"><div class="bar"></div><div class="bar"></div><div class="bar"></div></button>
        <div id="page-dashboard" class="page active"><h2>Dashboard</h2><div class="dashboard-grid"><div class="card"><h3>Total Users</h3><p id="total-users">0</p></div><div class="card"><h3>Pending Withdrawals</h3><p id="pending-withdrawals">0</p></div><div class="card"><h3>Total Withdrawn (Taka)</h3><p id="total-withdrawn">0</p></div><div class="card"><h3>Total Balance (All Users)</h3><p id="total-balance">0</p></div></div></div>
        <div id="page-users" class="page"><div class="table-container"><input type="text" id="user-search" class="form-control" placeholder="Search by Name or User ID..." style="margin-bottom: 20px;"><table><thead><tr><th>Name</th><th>User ID</th><th>Balance (TK)</th><th>Referrals</th><th>Actions</th></tr></thead><tbody id="users-table-body"></tbody></table></div></div>
        <div id="page-withdrawals" class="page"><h2>Withdrawal Requests</h2><div class="table-container"><h3>Pending Requests</h3><table><thead><tr><th>User Name</th><th>Amount</th><th>Method</th><th>Number</th><th>Actions</th></tr></thead><tbody id="pending-withdrawals-table"></tbody></table></div><div class="table-container" style="margin-top:30px;"><h3>Completed/Rejected History</h3><table><thead><tr><th>User Name</th><th>Amount</th><th>Method</th><th>Number</th><th>Status</th></tr></thead><tbody id="completed-withdrawals-table"></tbody></table></div></div>
        <div id="page-settings" class="page"><h2>App Settings</h2><form id="settings-form"><div class="settings-section"><h3>Rewards & Limits</h3><div class="form-group"><label>Minimum Withdraw Amount</label><input type="number" id="minWithdrawAmount" class="form-control"></div><div class="form-group"><label>Minimum Referrals for Withdraw</label><input type="number" id="minWithdrawReferrals" class="form-control"></div><div class="form-group"><label>Reward per Ad Task (Taka)</label><input type="number" id="adReward" class="form-control" step="0.01"></div><div class="form-group"><label>Reward per Referral (Taka)</label><input type="number" id="referralReward" class="form-control" step="0.01"></div></div><div class="settings-section"><h3>Content & UI</h3><div class="form-group"><label>Scrolling Offer Text</label><input type="text" id="marqueeText" class="form-control"></div><div class="form-group"><label>Welcome Popup Title</label><input type="text" id="welcomeMessageTitle" class="form-control"></div><div class="form-group"><label>Welcome Popup Body (HTML)</label><textarea id="welcomeMessageBody" class="form-control" rows="4"></textarea></div><div class="form-group"><label>Notice Popup Content (HTML)</label><textarea id="noticeContent" class="form-control" rows="4"></textarea></div></div><div class="settings-section"><h3>Links</h3><div class="form-group"><label>Tutorial Video Link</label><input type="url" id="tutorialLink" class="form-control"></div><div class="form-group"><label>Admin Chat Link</label><input type="url" id="adminChatLink" class="form-control"></div><div class="form-group"><label>Admin Call Link</label><input type="text" id="adminCallLink" class="form-control"></div><div class="form-group"><label>Telegram Channel Link (Task)</label><input type="url" id="telegramChannelLink" class="form-control"></div><div class="form-group"><label>YouTube Channel Link (Task)</label><input type="url" id="youtubeChannelLink" class="form-control"></div></div><button type="submit" class="btn btn-primary" style="width:100%; padding: 15px; font-size: 1.1rem;">Save All Settings</button></form></div>
        <div id="page-broadcast" class="page"><h2>Send Broadcast Message</h2><form id="broadcast-form"><div class="form-group"><label for="broadcast-message">Message</label><textarea id="broadcast-message" class="form-control" rows="4" required></textarea></div><div class="form-group"><label for="broadcast-image-url">Image URL (Optional)</label><input type="url" id="broadcast-image-url" class="form-control"></div><button type="submit" class="btn btn-primary">Send to All App Users</button></form></div>
    </main>

    <div id="edit-user-modal" class="modal"><div class="modal-content"><div class="modal-header"><h3>Edit User Details</h3><span style="cursor:pointer; font-size: 24px;" class="close-modal">&times;</span></div><form id="edit-user-form"><input type="hidden" id="edit-user-id"><div class="user-meta-info"><p><strong>User ID:</strong> <span id="display-user-id"></span></p><p><strong>Joined:</strong> <span id="display-join-date"></span></p></div><div class="form-group"><label>Full Name</label><input type="text" id="edit-user-name" class="form-control"></div><div class="form-group"><label>Balance</label><div class="adjustment-group"><input type="number" id="edit-user-balance" class="form-control" step="0.01"><button type="button" class="btn btn-success adjust-btn" data-field="edit-user-balance" data-amount="10">+</button><button type="button" class="btn btn-danger adjust-btn" data-field="edit-user-balance" data-amount="-10">-</button></div></div><div class="form-group"><label>Referrals</label><div class="adjustment-group"><input type="number" id="edit-user-referrals" class="form-control"><button type="button" class="btn btn-success adjust-btn" data-field="edit-user-referrals" data-amount="1">+</button><button type="button" class="btn btn-danger adjust-btn" data-field="edit-user-referrals" data-amount="-1">-</button></div></div><button type="submit" class="btn btn-primary" style="width: 100%;">Save Changes</button></form><hr style="border-color: var(--border-color); margin: 25px 0;"><button id="delete-user-btn" class="btn btn-danger" style="width: 100%;">Delete This User</button></div></div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getDatabase, ref, onValue, get, set, update, remove, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA2HUBFhHEWg4MwkJB4BVdJxUun0Gy07Ts",
            authDomain: "daily-earne-aea89.firebaseapp.com",
            databaseURL: "https://daily-earne-aea89-default-rtdb.firebaseio.com",
            projectId: "daily-earne-aea89",
            storageBucket: "daily-earne-aea89.appspot.com",
            messagingSenderId: "444567470638",
            appId: "1:444567470638:web:0fa323d9f5ef6aba1155bf"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        // --- UI & Navigation ---
        const ui = {
            loginOverlay: document.getElementById('login-overlay'),
            mainContent: document.querySelector('.main-content'),
            menuToggle: document.getElementById('menu-toggle'),
            sidebar: document.querySelector('.sidebar'),
            sidebarOverlay: document.getElementById('sidebar-overlay'),
            navItems: document.querySelectorAll('.nav-item'),
            pages: document.querySelectorAll('.page'),
            userModal: document.getElementById('edit-user-modal'),
            closeModalBtns: document.querySelectorAll('.close-modal'),
            adminEmailDisplay: document.getElementById('admin-email-display')
        };
        
        const toggleSidebar = () => { ui.sidebar.classList.toggle('open'); document.body.classList.toggle('sidebar-open'); };
        ui.menuToggle.addEventListener('click', toggleSidebar);
        ui.sidebarOverlay.addEventListener('click', toggleSidebar);
        ui.navItems.forEach(link => {
            link.addEventListener('click', e => {
                e.preventDefault();
                if (window.innerWidth < 768 && ui.sidebar.classList.contains('open')) toggleSidebar();
                ui.navItems.forEach(item => item.classList.remove('active'));
                ui.pages.forEach(page => page.classList.remove('active'));
                link.classList.add('active');
                document.getElementById(`page-${link.dataset.page}`).classList.add('active');
                loadPageData(link.dataset.page);
            });
        });
        ui.closeModalBtns.forEach(btn => btn.onclick = () => ui.userModal.style.display = 'none');

        // --- Auth State ---
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                try {
                    const adminRef = ref(db, 'admins/' + user.uid);
                    const snapshot = await get(adminRef);
                    if (snapshot.exists() && snapshot.val() === true) {
                        showAdminPanel(user);
                    } else {
                        alert('Access Denied. You are not an authorized admin.');
                        await signOut(auth);
                    }
                } catch (error) {
                    alert('Error verifying admin status: ' + error.message);
                    await signOut(auth);
                }
            } else {
                showLoginScreen();
            }
        });

        function showAdminPanel(user) {
            ui.loginOverlay.style.display = 'none';
            ui.mainContent.style.display = 'block';
            ui.menuToggle.style.display = 'flex';
            ui.adminEmailDisplay.innerText = user.email;
            if (window.innerWidth >= 768) { ui.sidebar.classList.add('open'); document.body.classList.add('sidebar-open'); }
            loadPageData('dashboard');
        }

        function showLoginScreen() {
            ui.loginOverlay.style.display = 'flex';
            ui.mainContent.style.display = 'none';
            ui.menuToggle.style.display = 'none';
            document.body.classList.remove('sidebar-open');
            ui.sidebar.classList.remove('open');
        }

        document.getElementById('login-form').addEventListener('submit', async e => {
            e.preventDefault();
            const btn = document.getElementById('login-btn');
            btn.disabled = true;
            btn.textContent = 'Logging in...';
            const email = document.getElementById('admin-email-input').value;
            const password = document.getElementById('admin-password').value;
            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                alert('Login Failed: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Login';
            }
        });

        document.getElementById('logout-btn').addEventListener('click', () => signOut(auth));

        // --- Page Data Logic ---
        const pageLoader = {
            dashboard: () => {
                onValue(ref(db, 'users'), s => { const d = s.val() || {}; document.getElementById('total-users').innerText = Object.keys(d).length; document.getElementById('total-balance').innerText = Object.values(d).reduce((sum, u) => sum + (u.balance || 0), 0).toFixed(2); });
                onValue(ref(db, 'withdrawals/pending'), s => document.getElementById('pending-withdrawals').innerText = s.exists() ? Object.keys(s.val()).length : 0);
                onValue(ref(db, 'withdrawals/completed'), s => { const t = Object.values(s.val()||{}).filter(w => w.status === 'approved').reduce((sum, w) => sum + (w.amount || 0), 0); document.getElementById('total-withdrawn').innerText = t.toFixed(2); });
            },
            users: () => onValue(ref(db, 'users'), s => renderUsersTable(s.val() || {})),
            withdrawals: () => {
                onValue(ref(db, 'withdrawals/pending'), s => renderWithdrawalsTable('pending-withdrawals-table', s.val() || {}));
                onValue(ref(db, 'withdrawals/completed'), s => renderWithdrawalsTable('completed-withdrawals-table', s.val() || {}));
            },
            settings: async () => {
                const s = await get(ref(db, 'settings'));
                if (s.exists()) { Object.entries(s.val()).forEach(([k, v]) => { if (document.getElementById(k)) document.getElementById(k).value = v; }); }
            }
        };
        const loadPageData = (page) => pageLoader[page]?.();

        // --- Users Page ---
        let allUsersData = {};
        function renderUsersTable(users) {
            allUsersData = users;
            const tBody = document.getElementById('users-table-body');
            const userArray = Object.entries(users).map(([uid, data]) => ({ uid, ...data }));
            userArray.sort((a, b) => (b.balance || 0) - (a.balance || 0));
            tBody.innerHTML = userArray.map(u => `
                <tr data-uid="${u.uid}" data-search="${(u.name||'').toLowerCase()} ${u.uid.toLowerCase()}">
                    <td>${u.name || 'N/A'}</td><td>${u.uid}</td>
                    <td>${(u.balance || 0).toFixed(2)}</td><td>${u.referrals || 0}</td>
                    <td><button class="btn btn-primary edit-user-btn" data-id="${u.uid}">Edit</button></td>
                </tr>`).join('') || `<tr><td colspan="5">No users found.</td></tr>`;
        }

        document.getElementById('user-search').addEventListener('keyup', e => {
            const term = e.target.value.toLowerCase();
            document.querySelectorAll('#users-table-body tr').forEach(r => {
                r.style.display = r.dataset.search.includes(term) ? '' : 'none';
            });
        });

        document.getElementById('users-table-body').addEventListener('click', e => {
            if (e.target.classList.contains('edit-user-btn')) {
                const u = allUsersData[e.target.dataset.id];
                if(u) {
                    document.getElementById('edit-user-id').value = e.target.dataset.id;
                    document.getElementById('display-user-id').innerText = e.target.dataset.id;
                    document.getElementById('display-join-date').innerText = u.joinDate ? new Date(u.joinDate).toLocaleString() : 'N/A';
                    document.getElementById('edit-user-name').value = u.name || '';
                    document.getElementById('edit-user-balance').value = u.balance || 0;
                    document.getElementById('edit-user-referrals').value = u.referrals || 0;
                    ui.userModal.style.display = 'flex';
                }
            }
        });
        
        document.getElementById('edit-user-modal').addEventListener('click', e => {
            if (e.target.classList.contains('adjust-btn')) {
                const field = document.getElementById(e.target.dataset.field);
                const amount = parseFloat(e.target.dataset.amount);
                field.value = (parseFloat(field.value) + amount).toFixed(field.step === '0.01' ? 2 : 0);
            }
        });

        document.getElementById('edit-user-form').addEventListener('submit', async e => {
            e.preventDefault();
            const uid = document.getElementById('edit-user-id').value;
            const updates = {
                name: document.getElementById('edit-user-name').value.trim(),
                balance: parseFloat(document.getElementById('edit-user-balance').value),
                referrals: parseInt(document.getElementById('edit-user-referrals').value)
            };
            try {
                await update(ref(db, `users/${uid}`), updates);
                alert('User updated successfully!');
                ui.userModal.style.display = 'none';
            } catch (err) { alert('Error: ' + err.message); }
        });

        document.getElementById('delete-user-btn').addEventListener('click', async () => {
            const uid = document.getElementById('edit-user-id').value;
            if (confirm(`Are you sure you want to permanently delete user ${uid}? This cannot be undone.`)) {
                try {
                    await remove(ref(db, `users/${uid}`));
                    alert('User deleted.');
                    ui.userModal.style.display = 'none';
                } catch (err) { alert('Error: ' + err.message); }
            }
        });

        // --- Withdrawals Page ---
        function renderWithdrawalsTable(tableId, data) {
            const tBody = document.getElementById(tableId);
            const isPending = tableId === 'pending-withdrawals-table';
            const reqs = Object.entries(data).sort(([,a],[,b]) => (b.timestamp||0)-(a.timestamp||0));
            tBody.innerHTML = reqs.map(([id, r]) => `
                <tr><td>${r.userName||'N/A'}</td><td>${r.amount}</td><td>${r.method}</td><td>${r.accountNumber}</td>
                <td>${isPending ? `<button class="btn btn-success" data-id="${id}" data-action="approved">Approve</button>
                                  <button class="btn btn-danger" data-id="${id}" data-action="rejected">Reject</button>` 
                                : `<span style="color:${r.status==='approved'?'var(--success-color)':'var(--error-color)'}">${r.status}</span>`}</td>
                </tr>`).join('') || `<tr><td colspan="5">No requests found.</td></tr>`;
        }

        document.getElementById('pending-withdrawals-table').addEventListener('click', async e => {
            if (e.target.tagName === 'BUTTON') {
                const id = e.target.dataset.id;
                const status = e.target.dataset.action;
                const confirmation = confirm(`Are you sure you want to ${status} this withdrawal request?`);
                if (!confirmation) return;
                
                const reqRef = ref(db, `withdrawals/pending/${id}`);
                const snapshot = await get(reqRef);

                if (!snapshot.exists()) {
                    alert('Request already processed or does not exist.');
                    return;
                }
                const reqData = snapshot.val();
                reqData.status = status;
                reqData.processedTimestamp = serverTimestamp();

                try {
                    await set(ref(db, `withdrawals/completed/${id}`), reqData);
                    await remove(reqRef);

                    if (status === 'rejected') {
                        const userBalRef = ref(db, `users/${reqData.userId}/balance`);
                        const userSnapshot = await get(userBalRef);
                        const currentBalance = userSnapshot.val() || 0;
                        await set(userBalRef, currentBalance + reqData.amount);
                        alert(`Request rejected. Amount ${reqData.amount} refunded to user.`);
                    } else {
                        alert(`Request approved successfully.`);
                    }
                } catch (error) {
                    alert('An error occurred: ' + error.message);
                }
            }
        });

        // --- Settings & Broadcast ---
        document.getElementById('settings-form').addEventListener('submit', async e => {
            e.preventDefault();
            const settings = {};
            new FormData(e.target).forEach((value, key) => settings[key] = isNaN(value) || value === '' ? value : Number(value));
            const allInputs = e.target.querySelectorAll('input, textarea');
            allInputs.forEach(input => settings[input.id] = isNaN(input.value) || input.value === '' ? input.value : Number(input.value));
            try {
                await set(ref(db, 'settings'), settings);
                alert('Settings saved!');
            } catch (err) { alert('Error: ' + err.message); }
        });

        document.getElementById('broadcast-form').addEventListener('submit', async e => {
            e.preventDefault();
            const message = {
                text: document.getElementById('broadcast-message').value,
                imageUrl: document.getElementById('broadcast-image-url').value.trim() || null,
                timestamp: serverTimestamp()
            };
            try {
                await set(ref(db, 'broadcast/latestMessage'), message);
                alert('Broadcast sent!');
                e.target.reset();
            } catch(err) { alert('Error: ' + err.message); }
        });
    </script>
</body>
</html>
