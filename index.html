<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Earning Live — Admin Panel (Full)</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#10b981;--muted:#94a3b8;--glass:rgba(255,255,255,0.03)}
    *{box-sizing:border-box}body{margin:0;font-family:Inter,system-ui,Roboto,"Noto Sans Bengali",sans-serif;background:linear-gradient(180deg,#071129,#081428);color:#e6eef8}
    .wrap{max-width:1100px;margin:18px auto;padding:16px}
    header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:14px}
    h1{font-size:20px;margin:0}
    .brand{display:flex;gap:12px;align-items:center}
    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.6);border:1px solid rgba(255,255,255,.03);margin-bottom:12px}
    nav{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    nav button{background:var(--glass);color:var(--muted);border:1px solid rgba(255,255,255,.04);padding:10px 12px;border-radius:10px;cursor:pointer}
    nav button.active{background:linear-gradient(90deg,var(--accent),#7c3aed);color:#071129;font-weight:700}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:12px}
    @media(max-width:980px){.grid{grid-template-columns:1fr}}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,.04);font-size:13px;color:#dbeafe}
    th{color:var(--muted);text-align:left}
    .btn{background:var(--accent);border:0;padding:8px 10px;border-radius:8px;cursor:pointer;color:#071129;font-weight:700}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,.06);color:var(--muted)}
    input,textarea,select{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,.04);background:transparent;color:#e6eef8}
    .muted{color:var(--muted);font-size:13px}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.03);font-weight:700}
    .status.pending{color:#f59e0b}
    .status.approved{color:#10b981}
    footer{color:var(--muted);text-align:center;margin-top:18px;font-size:13px}
    .small{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="pill">Earning Live</div>
        <h1>Admin Panel — Full</h1>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <div class="small" id="statSummary">Loading…</div>
        <button class="btn ghost" id="btnExportAll">Export Backup</button>
      </div>
    </header>

    <nav>
      <button data-tab="dashboard" class="active">Dashboard</button>
      <button data-tab="withdraws">Withdraws</button>
      <button data-tab="users">Users</button>
      <button data-tab="notice">Notice</button>
      <button data-tab="settings">Settings</button>
      <button data-tab="logs">Logs</button>
    </nav>

    <div class="grid">
      <main>
        <!-- DASHBOARD -->
        <section id="dashboard" class="card section active">
          <h2>Dashboard</h2>
          <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:12px">
            <div class="card" style="min-width:160px"><div class="muted">Total Users</div><div id="mUsers" style="font-weight:800;font-size:20px">0</div></div>
            <div class="card" style="min-width:160px"><div class="muted">Pending Withdraws</div><div id="mPending" style="font-weight:800;font-size:20px">0</div></div>
            <div class="card" style="min-width:160px"><div class="muted">Approved</div><div id="mApproved" style="font-weight:800;font-size:20px">0</div></div>
            <div class="card" style="flex:1"><div class="muted">Version</div><div id="mVersion">1.0.0</div></div>
          </div>
        </section>

        <!-- WITHDRAWS -->
        <section id="withdraws" class="card section">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h2>Withdraw Requests</h2>
            <div style="display:flex;gap:8px">
              <button class="btn ghost" id="btnRefreshWithdraws">Reload</button>
              <button class="btn ghost" id="btnExportWithdraws">Export JSON</button>
            </div>
          </div>
          <div style="margin-top:12px;overflow:auto">
            <table id="tblWithdraws"><thead><tr><th>ID</th><th>User</th><th>Method</th><th>Amount</th><th>Status</th><th>Txn</th><th>Action</th></tr></thead><tbody><tr><td colspan="7">Loading…</td></tr></tbody></table>
          </div>
        </section>

        <!-- USERS -->
        <section id="users" class="card section">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h2>Users</h2>
            <div style="display:flex;gap:8px">
              <button class="btn ghost" id="btnRefreshUsers">Reload</button>
              <button class="btn ghost" id="btnExportUsers">Export JSON</button>
            </div>
          </div>
          <div style="margin-top:12px;overflow:auto">
            <table id="tblUsers"><thead><tr><th>ID</th><th>Name</th><th>Balance</th><th>Status</th></tr></thead><tbody><tr><td colspan="4">Loading…</td></tr></tbody></table>
          </div>
        </section>

        <!-- NOTICE -->
        <section id="notice" class="card section">
          <h2>Send Notice</h2>
          <div style="margin-top:8px">
            <textarea id="noticeText" rows="4" placeholder="Write notice here..."></textarea>
            <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
              <button class="btn ghost" id="btnPreviewNotice">Preview to Owner</button>
              <button class="btn" id="btnSendNotice">Send to All</button>
            </div>
          </div>
        </section>

        <!-- SETTINGS -->
        <section id="settings" class="card section">
          <h2>Settings • Daily Bonus & Security</h2>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:8px">
            <div>
              <div class="small">Daily Bonus Enabled</div>
              <label style="display:flex;gap:8px;align-items:center;margin-top:6px"><input type="checkbox" id="bonusEnabled"/> <span class="muted" style="margin-left:6px">Enable daily bonus</span></label>
            </div>
            <div>
              <div class="small">Bonus Amount (৳)</div>
              <input id="bonusAmount" type="number" min="0" />
            </div>
            <div>
              <div class="small">Cooldown (hours)</div>
              <input id="bonusCooldown" type="number" min="1" />
            </div>
            <div>
              <div class="small">Admin PIN</div>
              <input id="adminPIN" type="text" />
            </div>
            <div style="grid-column:span 2;display:flex;gap:8px;justify-content:flex-end">
              <button class="btn ghost" id="btnResetDefaults">Reset Defaults</button>
              <button class="btn" id="btnSaveSettings">Save Settings</button>
            </div>
          </div>
        </section>

        <!-- LOGS -->
        <section id="logs" class="card section">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h2>Logs</h2>
            <div><button class="btn ghost" id="btnRefreshLogs">Reload</button></div>
          </div>
          <div style="margin-top:12px;max-height:360px;overflow:auto">
            <table id="tblLogs"><thead><tr><th>Time</th><th>Type</th><th>Info</th></tr></thead><tbody><tr><td colspan="3">Loading…</td></tr></tbody></table>
          </div>
        </section>
      </main>

      <aside>
        <div class="card">
          <div class="small">Bridge Info</div>
          <div style="margin-top:8px"><div class="muted">API URL</div><div id="infoUrl" class="small muted"></div></div>
          <div style="margin-top:8px"><div class="muted">Bridge Key</div><div id="infoKey" class="small muted"></div></div>
        </div>

        <div class="card">
          <div class="small">Quick Actions</div>
          <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
            <button class="btn" id="btnReloadAll">Reload All</button>
            <button class="btn ghost" id="btnExportCSV">Export Users CSV</button>
            <button class="btn ghost" id="btnExportWithdrawCSV">Export Withdraws CSV</button>
          </div>
        </div>

        <div class="card">
          <div class="small">Owner</div>
          <div style="margin-top:8px"><input id="ownerIds" placeholder="comma separated owner IDs"/></div>
          <div style="display:flex;gap:8px;margin-top:8px;justify-content:flex-end"><button class="btn ghost" id="btnSaveOwners">Save Owners</button></div>
        </div>
      </aside>
    </div>

    <footer>© <span id="year"></span> Earning Live — Admin Panel</footer>
  </div>

<script>
/* ===== CONFIG - PUT YOURS HERE ===== */
const BOT_ID = "5812860406";
const API_KEY = "8030917316:AAE2gZ1ZF2i1EUbhUCyUytYXoWI9mCZ_mbk";
const BRIDGE_KEY = "8030917316:AAE2gZ1ZF2i1EUbhUCyUytYXoWI9mCZ_mbk"; // must match Bridge script secret
const API_URL = `https://api.bots.business/v1/bot/${BOT_ID}/bridge`;

/* ====== Helpers ====== */
const HDRS = { "Content-Type":"application/json" };
function bridgePayload(action, data={}) {
  return { action, data, key: BRIDGE_KEY };
}
async function callBridge(action, data={}) {
  const res = await fetch(API_URL, {
    method:'POST',
    headers: HDRS,
    body: JSON.stringify(bridgePayload(action, data))
  });
  if(!res.ok) throw new Error('Bridge HTTP '+res.status);
  return await res.json();
}
function showToast(msg){ alert(msg) }

/* ====== UI helpers & nav ====== */
document.querySelectorAll('nav button').forEach(btn=>{
  btn.addEventListener('click', e=>{
    document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(btn.dataset.tab).classList.add('active');
  });
});
document.getElementById('year').textContent = new Date().getFullYear();
document.getElementById('infoUrl').textContent = API_URL;
document.getElementById('infoKey').textContent = BRIDGE_KEY ? 'set' : 'not-set';

/* ====== Dashboard/metrics ====== */
async function loadStats(){
  try{
    const s = await callBridge('stats');
    const r = s.result || s;
    document.getElementById('mUsers').textContent = r.users ?? 0;
    document.getElementById('mPending').textContent = r.pending ?? 0;
    document.getElementById('mApproved').textContent = r.approved ?? 0;
    document.getElementById('statSummary').textContent = `Users: ${r.users||0} • Pending: ${r.pending||0}`;
  }catch(e){ console.error(e) }
}

/* ====== Withdraws ====== */
async function loadWithdraws(){
  const res = await callBridge('withdraws');
  const rows = Array.isArray(res) ? res : (res.result||[]);
  const tbody = document.querySelector('#tblWithdraws tbody');
  tbody.innerHTML = '';
  if(rows.length===0){ tbody.innerHTML = '<tr><td colspan="7">No withdraws</td></tr>'; return; }
  for(const w of rows){
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${w.id}</td>
      <td>${w.userId}</td>
      <td>${w.method||'-'}</td>
      <td>${w.amount}৳</td>
      <td class="status ${w.status}">${w.status}</td>
      <td>${w.status==='pending' ? `<input id="txn-${w.id}" placeholder="Txn ID" />` : (w.txnId||'-')}</td>
      <td>${w.status==='pending' ? `<button class="btn" onclick="approveWithdraw('${w.id}')">Approve</button> <button class="btn ghost" onclick="rejectWithdrawPrompt('${w.id}')">Reject</button>` : '—'}</td>
    `;
    tbody.appendChild(tr);
  }
}
async function approveWithdraw(id){
  const txn = (document.getElementById(`txn-${id}`)||{value:''}).value.trim();
  if(!txn) return showToast('Please enter Txn ID');
  const resp = await callBridge('withdraw/approve', { id, txn });
  showToast(resp.message || 'Approved');
  await reloadAll();
}
async function rejectWithdrawPrompt(id){
  const reason = prompt('Reject reason (optional):','Invalid account');
  if(reason===null) return;
  const resp = await callBridge('withdraw/reject', { id, reason });
  showToast(resp.message || 'Rejected');
  await reloadAll();
}

/* ====== Users ====== */
async function loadUsers(){
  const res = await callBridge('users');
  const list = Array.isArray(res) ? res : (res.result||[]);
  const tbody = document.querySelector('#tblUsers tbody'); tbody.innerHTML = '';
  if(list.length===0){ tbody.innerHTML = '<tr><td colspan="4">No users</td></tr>'; return; }
  for(const u of list){
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${u.id}</td><td>${u.name||'-'}</td><td>${u.balance||0}৳</td><td>${u.status||'-'}</td>`;
    tbody.appendChild(tr);
  }
}

/* ====== Notice ====== */
document.getElementById('btnSendNotice').addEventListener('click', async ()=>{
  const t = document.getElementById('noticeText').value.trim();
  if(!t) return showToast('Write notice first');
  const resp = await callBridge('sendNotice', { text: t });
  showToast(resp.message || 'Notice sent');
});

/* ====== Settings ====== */
async function loadSettings(){
  try{
    const s = await callBridge('get_settings');
    const st = s.result || s;
    document.getElementById('bonusEnabled').checked = !!st.dailyBonusEnabled;
    document.getElementById('bonusAmount').value = st.bonusAmount ?? 10;
    document.getElementById('bonusCooldown').value = st.cooldownHours ?? 24;
    document.getElementById('adminPIN').value = st.adminPIN || '';
    document.getElementById('ownerIds').value = (st.owners||[]).join(',');
  }catch(e){ console.error(e) }
}
document.getElementById('btnSaveSettings').addEventListener('click', async ()=>{
  const payload = { enabled: document.getElementById('bonusEnabled').checked, amount: Number(document.getElementById('bonusAmount').value||0), cooldown: Number(document.getElementById('bonusCooldown').value||24), adminPIN: document.getElementById('adminPIN').value };
  const resp = await callBridge('set_settings', payload);
  showToast(resp.message || 'Saved');
  loadSettings();
});
document.getElementById('btnResetDefaults').addEventListener('click', async ()=>{
  if(confirm('Reset to defaults?')) {
    const resp = await callBridge('set_settings', { enabled:false, amount:10, cooldown:24 });
    showToast(resp.message || 'Reset');
    loadSettings();
  }
});
document.getElementById('btnSaveOwners').addEventListener('click', async ()=>{
  const owners = (document.getElementById('ownerIds').value||'').split(',').map(s=>s.trim()).filter(Boolean);
  const resp = await callBridge('set_settings', { owners });
  showToast(resp.message || 'Owners saved');
  loadSettings();
});

/* ====== Logs ====== */
async function loadLogs(){
  const res = await callBridge('logs');
  const list = Array.isArray(res) ? res : (res.result||[]);
  const tbody = document.querySelector('#tblLogs tbody'); tbody.innerHTML = '';
  if(list.length===0){ tbody.innerHTML = '<tr><td colspan="3">No logs</td></tr>'; return; }
  for(const l of list){
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${l.ts}</td><td>${l.type}</td><td><pre style="white-space:pre-wrap;margin:0">${JSON.stringify(l.info)}</pre></td>`;
    tbody.appendChild(tr);
  }
}

/* ====== Exports & Utilities ====== */
function downloadFile(filename, text){
  const a = document.createElement('a'); const blob = new Blob([text], {type:'application/json'}); a.href = URL.createObjectURL(blob); a.download = filename; a.click(); URL.revokeObjectURL(a.href);
}
document.getElementById('btnExportUsers').addEventListener('click', async ()=>{
  const r = await callBridge('users'); const data = JSON.stringify(r, null, 2); downloadFile('users.json', data);
});
document.getElementById('btnExportWithdraws').addEventListener('click', async ()=>{
  const r = await callBridge('withdraws'); const data = JSON.stringify(r, null, 2); downloadFile('withdraws.json', data);
});
document.getElementById('btnExportAll').addEventListener('click', async ()=>{
  const u = await callBridge('users'); const w = await callBridge('withdraws'); const s = await callBridge('get_settings'); const l = await callBridge('logs');
  downloadFile('backup.json', JSON.stringify({ users:u, withdraws:w, settings:s, logs:l }, null, 2));
});
document.getElementById('btnExportCSV').addEventListener('click', async ()=>{
  const r = await callBridge('users'); const arr = Array.isArray(r)?r:(r.result||[]);
  if(!arr.length) return showToast('No users'); const keys = Object.keys(arr[0]); const csv = [keys.join(',')].concat(arr.map(o=>keys.map(k=>JSON.stringify(o[k]||'')).join(','))).join('\n'); downloadFile('users.csv', csv);
});
document.getElementById('btnExportWithdrawCSV').addEventListener('click', async ()=>{
  const r = await callBridge('withdraws'); const arr = Array.isArray(r)?r:(r.result||[]);
  if(!arr.length) return showToast('No withdraws'); const keys = Object.keys(arr[0]); const csv = [keys.join(',')].concat(arr.map(o=>keys.map(k=>JSON.stringify(o[k]||'')).join(','))).join('\n'); downloadFile('withdraws.csv', csv);
});

/* ====== Reload All ====== */
async function reloadAll(){
  await Promise.all([ loadStats(), loadWithdraws(), loadUsers(), loadSettings(), loadLogs() ]);
}
document.getElementById('btnReloadAll').addEventListener('click', reloadAll);
document.getElementById('btnRefreshWithdraws').addEventListener('click', loadWithdraws);
document.getElementById('btnRefreshUsers').addEventListener('click', loadUsers);
document.getElementById('btnRefreshLogs').addEventListener('click', loadLogs);

/* ====== Init ====== */
(async ()=>{ try{ await reloadAll(); }catch(e){ console.error(e); showToast('Init error: '+e.message) } })();
</script>
</body>
</html>
